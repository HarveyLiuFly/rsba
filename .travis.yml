language: cpp
sudo: true

cache:
 - apt

compiler:
  - gcc
  - clang

env:
  - CM_ENV="-DCMAKE_BUILD_TYPE=Debug"
  - CM_ENV="-DCMAKE_BUILD_TYPE=RelWithDebInfo"
  - CM_ENV="-DCMAKE_BUILD_TYPE=Release"


install:
 - sudo apt-get install -qq cmake clang g++ libatlas-base-dev libeigen3-dev libsuitesparse-dev libgtest-dev
# libgoogle-glog-dev libgflags-dev
 - $CXX --version; $CC --version
 - "cd /usr/src/gtest && sudo cmake $CM_ENV . && sudo cmake --build . && sudo mv libg* /usr/local/lib/ ; cd -"
 - sudo ln -s /usr/include/eigen3/Eigen/ /usr/include/Eigen

#install openCV
 - sudo add-apt-repository "deb http://ppa.launchpad.net/alexei.colin/opencv/ubuntu precise main" -y
 - sudo apt-get update -qq
 - sudo apt-get install -qq libopencv-dev libopencv-nonfree-dev


 - mkdir thirdparty && cd thirdparty

# install gflags
 - curl https://gflags.googlecode.com/files/gflags-2.0-no-svn-files.tar.gz | tar xvz
 - cd gflags-2.0
 - ./configure --prefix=/usr/local
 - make -j2
 - sudo make install
 - cd ..

# install glog
 - curl https://google-glog.googlecode.com/files/glog-0.3.3.tar.gz | tar xvz
 - cd glog-0.3.3
 - ./configure --with-gflags=/usr/local/
 - make -j2
 - sudo make install
 - cd ..

# install ceres
 - curl http://ceres-solver.org/ceres-solver-1.9.0.tar.gz | tar xvz
 - mkdir ceres-bin && cd ceres-bin
 - cmake -DBUILD_TESTING=OFF -DBUILD_EXAMPLES=OFF $CM_ENV ../ceres-solver-1.9.0
 - make -j2
 - sudo make install
 - cd ..

# install thrift
 - sudo apt-add-repository "deb http://archive.ubuntu.com/ubuntu/ trusty main restricted" -y
 - sudo apt-get update -qq
 - sudo apt-get install -qq cmake clang g++ libboost-dev libboost-test-dev libboost-program-options-dev libboost-system-dev libboost-filesystem-dev libboost-chrono-dev libboost-thread-dev libevent-dev libtool flex bison pkg-config libssl-dev
 - $CXX --version; $CC --version

 - curl http://www.apache.org/dyn/closer.cgi?path=/thrift/0.9.3/thrift-0.9.3.tar.gz | tar zx 
 - cd thrift-0.9.3/
 - mkdir cmake_build && cd cmake_build
 - cmake -DBUILD_TESTING=OFF -DBUILD_EXAMPLES=OFF -DBUILD_C_GLIB=OFF -DBUILD_JAVA=OFF -DBUILD_PYTHON=OFF $CM_ENV ..
 - make -j2
 - sudo make install
 - cd ../..

 - cd ..



script:
 - mkdir build && cd build
 - cmake $CM_ENV ..
 - make -j2
 - make test
 - sudo make install

